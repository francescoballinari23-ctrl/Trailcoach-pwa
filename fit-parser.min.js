/**
 * Minified by jsDelivr using Terser v5.39.0.
 * Original file: /npm/@samijaber/fit-parser@1.9.6/dist/fit-parser.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const binary_1=require("./binary"),generateParsedFitObject=({fitObj:e,isCascadeNeeded:s,recordReader:t,crcStart:i,headerLength:r})=>{const o=[],a=[],n=[],c=[],p=[],d=[],l=[],h=[],f=[],_=[],u=[],v=[],b=[],m=[],g=[],k=[],y=[],w=[];let F,O,C=[],T=[],I=[],j=r,P=0;for(;j<i;){const{nextIndex:i,messageType:r,message:R}=t({startIndex:j,startDate:F,pausedTime:P});switch(j=i,r){case"lap":s&&(R.records=I,I=[],C.push(R),R.lengths=T,T=[]),a.push(R);break;case"session":s&&(R.laps=C,C=[]),o.push(R);break;case"event":"timer"===R.event&&("stop_all"===R.event_type?O=R.timestamp:"start"===R.event_type&&O&&(P+=(R.timestamp-O)/1e3)),c.push(R);break;case"length":s&&T.push(R),y.push(R);break;case"hrv":p.push(R);break;case"record":F||(F=R.timestamp,R.elapsed_time=0,R.timer_time=0),n.push(R),s&&I.push(R);break;case"field_description":h.push(R);break;case"device_info":d.push(R);break;case"developer_data_id":l.push(R);break;case"dive_gas":f.push(R);break;case"course_point":_.push(R);break;case"sport":u.push(R);break;case"file_id":R&&g.push(R);break;case"definition":R&&m.push(R);break;case"monitoring":v.push(R);break;case"monitoring_info":k.push(R);break;case"stress_level":b.push(R);break;case"workout_step":w.push(R);break;case"software":e.software=R;break;default:""!==r&&(e[r]=R)}}return{sessions:o,events:c,hrv:p,devices:d,applications:l,fieldDescriptions:h,sports:u,laps:a,lengths:y,records:n,dive_gases:f,course_points:_,monitors:v,stress:b,file_ids:g,monitor_info:k,definitions:m,workout_step:w}},DEFAULT_OPTIONS={force:!0,speedUnit:"m/s",lengthUnit:"m",temperatureUnit:"Â°C",elapsedRecordField:!1,mode:"list"};class FitParser{constructor(e={}){this.options=Object.assign(Object.assign({},e),DEFAULT_OPTIONS)}parse(e){const s=new Uint8Array((0,binary_1.getArrayBuffer)(e));if(s.length<12){const e=new Error("File too small to be a FIT file");if(this.options.force)throw e;console.error(e)}const t=s[0];if(14!==t&&12!==t){const e=new Error("Incorrect header size");if(this.options.force)throw e;console.error(e)}let i="";for(let e=8;e<12;e++)i+=String.fromCharCode(s[e]);if(".FIT"!==i){const e=new Error("Missing '.FIT' in header");if(this.options.force)throw e;console.error(e)}if(14===t){if(s[12]+(s[13]<<8)!==(0,binary_1.calculateCRC)(s,0,12)&&!this.options.force)return}const r=s[1],o=s[2]+(s[3]<<8),a=s[4]+(s[5]<<8)+(s[6]<<16)+(s[7]<<24)+t;if(s[a]+(s[a+1]<<8)!==(0,binary_1.calculateCRC)(s,12===t?0:t,a)&&!this.options.force)return;const n={};n.protocolVersion=r,n.profileVersion=o;const c="cascade"===this.options.mode,p=c||"both"===this.options.mode,d=(0,binary_1.readRecord)({blob:s,options:this.options}),{applications:l,devices:h,events:f,fieldDescriptions:_,hrv:u,sessions:v,sports:b,laps:m,lengths:g,records:k,dive_gases:y,course_points:w,monitors:F,stress:O,file_ids:C,monitor_info:T,definitions:I,workout_step:j}=generateParsedFitObject({fitObj:n,isCascadeNeeded:p,recordReader:d,crcStart:a,headerLength:t});return p&&(n.activity=n.activity||{},n.activity.sessions=v,n.activity.events=f,n.activity.hrv=u,n.activity.device_infos=h,n.activity.developer_data_ids=l,n.activity.field_descriptions=_,n.activity.sports=b),c||(n.sessions=v,n.laps=m,n.lengths=g,n.records=k,n.events=f,n.device_infos=h,n.developer_data_ids=l,n.field_descriptions=_,n.hrv=u,n.dive_gases=y,n.course_points=w,n.sports=b,n.devices=h,n.monitors=F,n.stress=O,n.file_ids=C,n.monitor_info=T,n.definitions=I,n.workout_step=j),n}}exports.default=FitParser;
//# sourceMappingURL=/sm/d6bc3e828c01c540287af7cd5345a5dc0f8085b12ff548b24397588d9b954917.map